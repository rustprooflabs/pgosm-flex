<!DOCTYPE HTML>
<html lang="en" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Processing Time - PgOSM Flex User Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="PgOSM Flex provides high quality OpenStreetMap datasets in PostGIS using the osm2pgsql Flex output">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">About PgOSM Flex</a></li><li class="chapter-item expanded affix "><a href="code-of-conduct.html">Code of Conduct</a></li><li class="chapter-item expanded affix "><a href="contributing.html">Contributing to PgOSM Flex</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="windows.html"><strong aria-hidden="true">1.1.</strong> Running on Windows</a></li></ol></li><li class="chapter-item expanded "><a href="customizations.html"><strong aria-hidden="true">2.</strong> Customize PgOSM Flex</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="common-customization.html"><strong aria-hidden="true">2.1.</strong> Common Customizations</a></li><li class="chapter-item expanded "><a href="layersets.html"><strong aria-hidden="true">2.2.</strong> Layersets</a></li><li class="chapter-item expanded "><a href="custom-indexes.html"><strong aria-hidden="true">2.3.</strong> Indexes</a></li><li class="chapter-item expanded "><a href="configure-postgres.html"><strong aria-hidden="true">2.4.</strong> Configure Postgres</a></li><li class="chapter-item expanded "><a href="data-files.html"><strong aria-hidden="true">2.5.</strong> Data Files</a></li></ol></li><li class="chapter-item expanded "><a href="query.html"><strong aria-hidden="true">3.</strong> Query examples</a></li><li class="chapter-item expanded "><a href="routing.html"><strong aria-hidden="true">4.</strong> Routing</a></li><li class="chapter-item expanded "><a href="performance.html" class="active"><strong aria-hidden="true">5.</strong> Processing Time</a></li><li class="chapter-item expanded affix "><li class="part-title">Production usages</li><li class="chapter-item expanded "><a href="postgres-permissions.html"><strong aria-hidden="true">6.</strong> Postgres Permissions</a></li><li class="chapter-item expanded "><a href="postgres-external.html"><strong aria-hidden="true">7.</strong> Using External Postgres Connection</a></li><li class="chapter-item expanded "><a href="data-updates.html"><strong aria-hidden="true">8.</strong> Data updates</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="replication.html"><strong aria-hidden="true">8.1.</strong> Using Replication</a></li><li class="chapter-item expanded "><a href="relocate-data.html"><strong aria-hidden="true">8.2.</strong> Relocate Data</a></li><li class="chapter-item expanded "><a href="update-mode.html"><strong aria-hidden="true">8.3.</strong> Using Update Mode</a></li></ol></li><li class="chapter-item expanded "><a href="qgis-styles.html"><strong aria-hidden="true">9.</strong> QGIS Styles</a></li><li class="chapter-item expanded affix "><li class="part-title">Developers</li><li class="chapter-item expanded "><a href="force-load.html"><strong aria-hidden="true">10.</strong> Force Load</a></li><li class="chapter-item expanded "><a href="projects.html"><strong aria-hidden="true">11.</strong> Projects using PgOSM Flex</a></li><li class="chapter-item expanded "><a href="docker-build.html"><strong aria-hidden="true">12.</strong> Build and Push Docker Images</a></li><li class="chapter-item expanded "><a href="tests.html"><strong aria-hidden="true">13.</strong> Testing PgOSM Flex</a></li><li class="chapter-item expanded "><a href="qgis-styles-dev.html"><strong aria-hidden="true">14.</strong> Developing QGIS Styles</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">15.</strong> Troubleshoot errors in osm2pgsql processing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PgOSM Flex User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rustprooflabs/pgosm-flex" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rustprooflabs/pgosm-flex/edit/main/docs/src/performance.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="processing-time"><a class="header" href="#processing-time">Processing Time</a></h1>
<p>The purpose of this page is to provide a rough guideline of what to
expect for how long PgOSM Flex processing will take.
Two server sizes are used for this testing hosted by Digital Ocean.
The larger size server
has 8 vCPU and 64 GB RAM to match the target
server size <a href="https://osm2pgsql.org/doc/manual.html#preparing-the-database">outlined in the osm2pgsql manual</a>. The current matching Digital Ocean
resource class is the Memory-Optimized with dedicated CPU resources.
This comes with a 200 GB SSD. The cost for this class of instance
is $0.500 / hour, or $336 / month.  A good number of production Postgres
instances can run on this hardware.</p>
<p>The smaller server size is a budget friendly 2 AMD vCPU and 2 GB RAM
on shared CPU resources. The cost for this class of instance is
$0.031 / hour, or $21 / month.</p>
<h2 id="versions-tested"><a class="header" href="#versions-tested">Versions Tested</a></h2>
<p>Versions used for testing: PgOSM Flex 0.7.1 Docker image, based on the official
PostGIS image with Postgres 15.2 / PostGIS 3.3.  osm2pgsql 1.8.1.</p>
<p>Note: Postgres 15 <a href="https://osm2pgsql.org/news/2023/01/22/faster-with-postgresql15.html">made GIST indexes faster</a>
to create.  Using an version prior to Postgres 14 will likely take longer.</p>
<h2 id="methodology"><a class="header" href="#methodology">Methodology</a></h2>
<p>Create instance, Ubuntu 22.04.</p>
<pre><code class="language-bash">sudo apt update \
    &amp;&amp; sudo apt upgrade -y \
    &amp;&amp; sudo apt autoremove -y \
    &amp;&amp; sudo apt install -y apt-transport-https ca-certificates curl software-properties-common \
    &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg \
    &amp;&amp; echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null \
    &amp;&amp; sudo apt update \
    &amp;&amp; sudo apt install docker-ce \
    &amp;&amp; sudo reboot -h now
</code></pre>
<p>The timing for the first <code>docker exec</code> for each region was discarded as
it included the timing for downloading the PBF file.</p>
<p>Timings are an average of multiple recorded test runs over more than one day.
For example, the Norway region for the <code>minimal</code> layerset had two times: 5 min 35 seconds
and 5 minutes 37 seconds for an average of 5 minutes 36 seconds.</p>
<p>Time for the import step is reported using the Linux <code>time</code> command on the <code>docker exec</code>
step as shown in the following commands.</p>
<p><code>PostGIS Size</code> reported is according to the meta-data in Postgres using this query.</p>
<pre><code class="language-sql">SELECT d.oid, d.datname AS db_name,
        pg_size_pretty(pg_database_size(d.datname)) AS db_size
    FROM pg_catalog.pg_database d
    WHERE d.datname = current_database()
</code></pre>
<h3 id="commands"><a class="header" href="#commands">Commands</a></h3>
<p>Set environment variables and start <code>pgosm</code> Docker container with configurations
set per the <a href="https://osm2pgsql.org/doc/manual.html#tuning-the-postgresql-server">osm2pgsql tuning guidelines</a>.</p>
<pre><code class="language-bash">export POSTGRES_USER=postgres
export POSTGRES_PASSWORD=mysecretpassword

docker run --name pgosm -d --rm \
    -v ~/pgosm-data:/app/output \
    -v /etc/localtime:/etc/localtime:ro \
    -e POSTGRES_PASSWORD=$POSTGRES_PASSWORD \
    -p 5433:5432 -d rustprooflabs/pgosm-flex:0.7.1 \
    -c shared_buffers=1GB \
    -c work_mem=50MB \
    -c maintenance_work_mem=10GB \
    -c autovacuum_work_mem=2GB \
    -c checkpoint_timeout=300min \
    -c max_wal_senders=0 -c wal_level=minimal \
    -c max_wal_size=10GB \
    -c checkpoint_completion_target=0.9 \
    -c random_page_cost=1.0 \
    -c full_page_writes=off \
    -c fsync=off
</code></pre>
<blockquote>
<p>WARNING:  Setting <code>full_page_writes=off</code> and <code>fsync=off</code> is part of the <a href="https://osm2pgsql.org/doc/manual.html#expert-tuning">expert tuning</a> for the best possible performance.  This is deemed acceptable in this Docker container running <code>--rm</code>, obviously this container will be discarded immediately after processing. <strong>DO NOT</strong> use these configurations unless you understand and accept the risks of corruption.</p>
</blockquote>
<p>Run PgOSM Flex within Docker.  The first run time is discarded because the first
run time includes time downloading the PBF file.  Subsequent runs only include the
time running the processing.</p>
<pre><code class="language-bash">
time docker exec -it \
    pgosm python3 docker/pgosm_flex.py \
    --ram=64 \
    --region=north-america/us \
    --subregion=colorado \
    --layerset=minimal
</code></pre>
<h2 id="layerset--minimal"><a class="header" href="#layerset--minimal">Layerset:  Minimal</a></h2>
<p>The <code>minimal</code> layer set only loads major roads, places, and POIs.</p>
<p>Timings with nested admin polygons and dumping the processed data to a <code>.sql</code>
file.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Sub-region</th><th style="text-align: center">PBF Size</th><th style="text-align: center">PostGIS Size</th><th style="text-align: center"><code>.sql</code> Size</th><th style="text-align: center">Import Time</th></tr></thead><tbody>
<tr><td style="text-align: left">District of Columbia</td><td style="text-align: center">18 MB</td><td style="text-align: center">36 MB</td><td style="text-align: center">14 MB</td><td style="text-align: center">15.3 sec</td></tr>
<tr><td style="text-align: left">Colorado</td><td style="text-align: center">226 MB</td><td style="text-align: center">181 MB</td><td style="text-align: center">129 MB</td><td style="text-align: center">1 min 23 sec</td></tr>
<tr><td style="text-align: left">Norway</td><td style="text-align: center">1.1 GB</td><td style="text-align: center">618 MB</td><td style="text-align: center">489 MB</td><td style="text-align: center">5 min 36 sec</td></tr>
<tr><td style="text-align: left">North America</td><td style="text-align: center">12 GB</td><td style="text-align: center">9.5 GB</td><td style="text-align: center">7.7 GB</td><td style="text-align: center">3.03 hours</td></tr>
</tbody></table>
</div>
<p>Timings skipping nested admin polygons the dump to <code>.sql</code>.  This adds
<code>--skip-dump --skip-nested</code> to the <code>docker exec process</code>. The following
table compares the import time using these skips against the full times reported
above.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Sub-region</th><th style="text-align: center">Import Time (full)</th><th style="text-align: center">Import Time (skips)</th></tr></thead><tbody>
<tr><td style="text-align: left">District of Columbia</td><td style="text-align: center">15.3 sec</td><td style="text-align: center">15.0 sec</td></tr>
<tr><td style="text-align: left">Colorado</td><td style="text-align: center">1 min 23 sec</td><td style="text-align: center">1 min 21 sec</td></tr>
<tr><td style="text-align: left">Norway</td><td style="text-align: center">5 min 36 sec</td><td style="text-align: center">5 min 12 sec</td></tr>
<tr><td style="text-align: left">North America</td><td style="text-align: center">3.03 hours</td><td style="text-align: center">1.25 hours</td></tr>
</tbody></table>
</div>
<h2 id="layerset--default"><a class="header" href="#layerset--default">Layerset:  Default</a></h2>
<p>The <code>default</code> layer set....</p>
<p>Timings with nested admin polygons and dumping the processed data to a <code>.sql</code>
file.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Sub-region</th><th style="text-align: center">PBF Size</th><th style="text-align: center">PostGIS Size</th><th style="text-align: center"><code>.sql</code> Size</th><th style="text-align: center">Import Time</th></tr></thead><tbody>
<tr><td style="text-align: left">District of Columbia</td><td style="text-align: center">18 MB</td><td style="text-align: center">212 MB</td><td style="text-align: center">160 MB</td><td style="text-align: center">53 sec</td></tr>
<tr><td style="text-align: left">Colorado</td><td style="text-align: center">226 MB</td><td style="text-align: center">2.1 GB</td><td style="text-align: center">1.9 GB</td><td style="text-align: center">8 min 20 sec</td></tr>
<tr><td style="text-align: left">Norway</td><td style="text-align: center">1.1 GB</td><td style="text-align: center">7.2 GB</td><td style="text-align: center">6.5 GB</td><td style="text-align: center">33 min 44 sec</td></tr>
<tr><td style="text-align: left">North America</td><td style="text-align: center">12 GB</td><td style="text-align: center">98 GB</td><td style="text-align: center">55 GB</td><td style="text-align: center">8.78 hours</td></tr>
</tbody></table>
</div>
<p>Timings skipping nested admin polygons the dump to <code>.sql</code>.  This adds
<code>--skip-dump --skip-nested</code> to the <code>docker exec process</code>. The following
table compares the import time using these skips against the full times reported
above.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Sub-region</th><th style="text-align: center">Import Time (full)</th><th style="text-align: center">Import Time (skips)</th></tr></thead><tbody>
<tr><td style="text-align: left">District of Columbia</td><td style="text-align: center">53 sec</td><td style="text-align: center">51 sec</td></tr>
<tr><td style="text-align: left">Colorado</td><td style="text-align: center">8 min 20 sec</td><td style="text-align: center">7 min 55 sec</td></tr>
<tr><td style="text-align: left">Norway</td><td style="text-align: center">33 min 44 sec</td><td style="text-align: center">32 min 18 sec</td></tr>
<tr><td style="text-align: left">North America</td><td style="text-align: center">8.78 hours</td><td style="text-align: center">6.58 hours</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="routing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="postgres-permissions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="routing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="postgres-permissions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
